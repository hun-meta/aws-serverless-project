#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("source-map-support/register");
const cdk = require("aws-cdk-lib");
const environment_1 = require("../lib/utils/environment");
const naming_1 = require("../lib/utils/naming");
const tags_1 = require("../lib/utils/tags");
const constants_1 = require("../lib/utils/constants");
// Import all stacks
const iam_stack_1 = require("../lib/stacks/iam-stack");
const vpc_stack_1 = require("../lib/stacks/vpc-stack");
const security_group_stack_1 = require("../lib/stacks/security-group-stack");
const s3_stack_1 = require("../lib/stacks/s3-stack");
const database_stack_1 = require("../lib/stacks/database-stack");
const ec2_stack_1 = require("../lib/stacks/ec2-stack");
const lambda_stack_1 = require("../lib/stacks/lambda-stack");
const api_gateway_stack_1 = require("../lib/stacks/api-gateway-stack");
const app = new cdk.App();
// Get environment configuration
const config = (0, environment_1.getEnvironmentConfig)(app);
const namingHelper = new naming_1.NamingHelper(config.stage);
const taggingHelper = (0, tags_1.createTaggingHelper)(config.stage);
console.log(`Deploying to ${config.stage} environment`);
console.log(`Region: ${config.environment.region}`);
console.log(`Account: ${config.environment.account}`);
// Stack properties
const stackProps = {
    env: config.environment,
    description: `${config.stage} environment stack for serverless backend infrastructure`,
    terminationProtection: config.isProd
};
// Create IAM Stack (must be first)
const iamStack = new iam_stack_1.IamStack(app, namingHelper.getStackName(constants_1.STACK_NAMES.IAM), {
    ...stackProps,
    config,
    namingHelper,
    taggingHelper
});
// Create VPC Stack
const vpcStack = new vpc_stack_1.VpcStack(app, namingHelper.getStackName(constants_1.STACK_NAMES.VPC), {
    ...stackProps,
    config,
    namingHelper,
    taggingHelper
});
// Create Security Group Stack
const securityGroupStack = new security_group_stack_1.SecurityGroupStack(app, namingHelper.getStackName(constants_1.STACK_NAMES.SECURITY_GROUP), {
    ...stackProps,
    config,
    namingHelper,
    taggingHelper,
    vpc: vpcStack.vpc
});
// Create S3 Stack
const s3Stack = new s3_stack_1.S3Stack(app, namingHelper.getStackName(constants_1.STACK_NAMES.S3), {
    ...stackProps,
    config,
    namingHelper,
    taggingHelper
});
// Create Database Stack
const databaseStack = new database_stack_1.DatabaseStack(app, namingHelper.getStackName(constants_1.STACK_NAMES.DATABASE), {
    ...stackProps,
    config,
    namingHelper,
    taggingHelper,
    vpc: vpcStack.vpc,
    databaseSecurityGroups: [
        securityGroupStack.dbSshGroup,
        securityGroupStack.dbPrivateGroup
    ]
});
// Create EC2 Stack
const ec2Stack = new ec2_stack_1.Ec2Stack(app, namingHelper.getStackName(constants_1.STACK_NAMES.EC2), {
    ...stackProps,
    config,
    namingHelper,
    taggingHelper,
    vpc: vpcStack.vpc,
    publicSshSecurityGroup: securityGroupStack.publicSshGroup,
    bastionOutboundSecurityGroup: securityGroupStack.bastionOutboundGroup,
    natSecurityGroup: securityGroupStack.natGroup
});
// Create Lambda Stack
const lambdaStack = new lambda_stack_1.LambdaStack(app, namingHelper.getStackName(constants_1.STACK_NAMES.LAMBDA), {
    ...stackProps,
    config,
    namingHelper,
    taggingHelper,
    vpc: vpcStack.vpc,
    lambdaSecurityGroup: securityGroupStack.lambdaOutboundGroup,
    lambdaRole: iamStack.customLambdaCommonRole
});
// Create API Gateway Stack
const apiGatewayStack = new api_gateway_stack_1.ApiGatewayStack(app, namingHelper.getStackName(constants_1.STACK_NAMES.API_GATEWAY), {
    ...stackProps,
    config,
    namingHelper,
    taggingHelper,
    healthCheckFunction: lambdaStack.healthCheckFunction,
    apiGatewayRole: iamStack.customApiGatewayLogRole
});
// Set up dependencies
securityGroupStack.addDependency(vpcStack);
databaseStack.addDependency(securityGroupStack);
ec2Stack.addDependency(securityGroupStack);
lambdaStack.addDependency(securityGroupStack);
lambdaStack.addDependency(iamStack);
apiGatewayStack.addDependency(lambdaStack);
apiGatewayStack.addDependency(iamStack);
// Apply tags to the entire app
taggingHelper.applyTags(app, {
    Application: 'Serverless Backend',
    Version: '1.0.0',
    Repository: 'cdk-prj'
});
// Synthesize the app
app.synth();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2RrLXByai5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNkay1wcmoudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsdUNBQXFDO0FBQ3JDLG1DQUFtQztBQUNuQywwREFBZ0U7QUFDaEUsZ0RBQW1EO0FBQ25ELDRDQUF3RDtBQUN4RCxzREFBcUQ7QUFFckQsb0JBQW9CO0FBQ3BCLHVEQUFtRDtBQUNuRCx1REFBbUQ7QUFDbkQsNkVBQXdFO0FBQ3hFLHFEQUFpRDtBQUNqRCxpRUFBNkQ7QUFDN0QsdURBQW1EO0FBQ25ELDZEQUF5RDtBQUN6RCx1RUFBa0U7QUFFbEUsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7QUFFMUIsZ0NBQWdDO0FBQ2hDLE1BQU0sTUFBTSxHQUFHLElBQUEsa0NBQW9CLEVBQUMsR0FBRyxDQUFDLENBQUM7QUFDekMsTUFBTSxZQUFZLEdBQUcsSUFBSSxxQkFBWSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNwRCxNQUFNLGFBQWEsR0FBRyxJQUFBLDBCQUFtQixFQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUV4RCxPQUFPLENBQUMsR0FBRyxDQUFDLGdCQUFnQixNQUFNLENBQUMsS0FBSyxjQUFjLENBQUMsQ0FBQztBQUN4RCxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsTUFBTSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO0FBQ3BELE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxNQUFNLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7QUFFdEQsbUJBQW1CO0FBQ25CLE1BQU0sVUFBVSxHQUFtQjtJQUNqQyxHQUFHLEVBQUUsTUFBTSxDQUFDLFdBQVc7SUFDdkIsV0FBVyxFQUFFLEdBQUcsTUFBTSxDQUFDLEtBQUssMERBQTBEO0lBQ3RGLHFCQUFxQixFQUFFLE1BQU0sQ0FBQyxNQUFNO0NBQ3JDLENBQUM7QUFFRixtQ0FBbUM7QUFDbkMsTUFBTSxRQUFRLEdBQUcsSUFBSSxvQkFBUSxDQUFDLEdBQUcsRUFBRSxZQUFZLENBQUMsWUFBWSxDQUFDLHVCQUFXLENBQUMsR0FBRyxDQUFDLEVBQUU7SUFDN0UsR0FBRyxVQUFVO0lBQ2IsTUFBTTtJQUNOLFlBQVk7SUFDWixhQUFhO0NBQ2QsQ0FBQyxDQUFDO0FBRUgsbUJBQW1CO0FBQ25CLE1BQU0sUUFBUSxHQUFHLElBQUksb0JBQVEsQ0FBQyxHQUFHLEVBQUUsWUFBWSxDQUFDLFlBQVksQ0FBQyx1QkFBVyxDQUFDLEdBQUcsQ0FBQyxFQUFFO0lBQzdFLEdBQUcsVUFBVTtJQUNiLE1BQU07SUFDTixZQUFZO0lBQ1osYUFBYTtDQUNkLENBQUMsQ0FBQztBQUVILDhCQUE4QjtBQUM5QixNQUFNLGtCQUFrQixHQUFHLElBQUkseUNBQWtCLENBQUMsR0FBRyxFQUFFLFlBQVksQ0FBQyxZQUFZLENBQUMsdUJBQVcsQ0FBQyxjQUFjLENBQUMsRUFBRTtJQUM1RyxHQUFHLFVBQVU7SUFDYixNQUFNO0lBQ04sWUFBWTtJQUNaLGFBQWE7SUFDYixHQUFHLEVBQUUsUUFBUSxDQUFDLEdBQUc7Q0FDbEIsQ0FBQyxDQUFDO0FBRUgsa0JBQWtCO0FBQ2xCLE1BQU0sT0FBTyxHQUFHLElBQUksa0JBQU8sQ0FBQyxHQUFHLEVBQUUsWUFBWSxDQUFDLFlBQVksQ0FBQyx1QkFBVyxDQUFDLEVBQUUsQ0FBQyxFQUFFO0lBQzFFLEdBQUcsVUFBVTtJQUNiLE1BQU07SUFDTixZQUFZO0lBQ1osYUFBYTtDQUNkLENBQUMsQ0FBQztBQUVILHdCQUF3QjtBQUN4QixNQUFNLGFBQWEsR0FBRyxJQUFJLDhCQUFhLENBQUMsR0FBRyxFQUFFLFlBQVksQ0FBQyxZQUFZLENBQUMsdUJBQVcsQ0FBQyxRQUFRLENBQUMsRUFBRTtJQUM1RixHQUFHLFVBQVU7SUFDYixNQUFNO0lBQ04sWUFBWTtJQUNaLGFBQWE7SUFDYixHQUFHLEVBQUUsUUFBUSxDQUFDLEdBQUc7SUFDakIsc0JBQXNCLEVBQUU7UUFDdEIsa0JBQWtCLENBQUMsVUFBVTtRQUM3QixrQkFBa0IsQ0FBQyxjQUFjO0tBQ2xDO0NBQ0YsQ0FBQyxDQUFDO0FBRUgsbUJBQW1CO0FBQ25CLE1BQU0sUUFBUSxHQUFHLElBQUksb0JBQVEsQ0FBQyxHQUFHLEVBQUUsWUFBWSxDQUFDLFlBQVksQ0FBQyx1QkFBVyxDQUFDLEdBQUcsQ0FBQyxFQUFFO0lBQzdFLEdBQUcsVUFBVTtJQUNiLE1BQU07SUFDTixZQUFZO0lBQ1osYUFBYTtJQUNiLEdBQUcsRUFBRSxRQUFRLENBQUMsR0FBRztJQUNqQixzQkFBc0IsRUFBRSxrQkFBa0IsQ0FBQyxjQUFjO0lBQ3pELDRCQUE0QixFQUFFLGtCQUFrQixDQUFDLG9CQUFvQjtJQUNyRSxnQkFBZ0IsRUFBRSxrQkFBa0IsQ0FBQyxRQUFRO0NBQzlDLENBQUMsQ0FBQztBQUVILHNCQUFzQjtBQUN0QixNQUFNLFdBQVcsR0FBRyxJQUFJLDBCQUFXLENBQUMsR0FBRyxFQUFFLFlBQVksQ0FBQyxZQUFZLENBQUMsdUJBQVcsQ0FBQyxNQUFNLENBQUMsRUFBRTtJQUN0RixHQUFHLFVBQVU7SUFDYixNQUFNO0lBQ04sWUFBWTtJQUNaLGFBQWE7SUFDYixHQUFHLEVBQUUsUUFBUSxDQUFDLEdBQUc7SUFDakIsbUJBQW1CLEVBQUUsa0JBQWtCLENBQUMsbUJBQW1CO0lBQzNELFVBQVUsRUFBRSxRQUFRLENBQUMsc0JBQXNCO0NBQzVDLENBQUMsQ0FBQztBQUVILDJCQUEyQjtBQUMzQixNQUFNLGVBQWUsR0FBRyxJQUFJLG1DQUFlLENBQUMsR0FBRyxFQUFFLFlBQVksQ0FBQyxZQUFZLENBQUMsdUJBQVcsQ0FBQyxXQUFXLENBQUMsRUFBRTtJQUNuRyxHQUFHLFVBQVU7SUFDYixNQUFNO0lBQ04sWUFBWTtJQUNaLGFBQWE7SUFDYixtQkFBbUIsRUFBRSxXQUFXLENBQUMsbUJBQW1CO0lBQ3BELGNBQWMsRUFBRSxRQUFRLENBQUMsdUJBQXVCO0NBQ2pELENBQUMsQ0FBQztBQUVILHNCQUFzQjtBQUN0QixrQkFBa0IsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDM0MsYUFBYSxDQUFDLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQ2hELFFBQVEsQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQUMsQ0FBQztBQUMzQyxXQUFXLENBQUMsYUFBYSxDQUFDLGtCQUFrQixDQUFDLENBQUM7QUFDOUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNwQyxlQUFlLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQzNDLGVBQWUsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7QUFFeEMsK0JBQStCO0FBQy9CLGFBQWEsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFO0lBQzNCLFdBQVcsRUFBRSxvQkFBb0I7SUFDakMsT0FBTyxFQUFFLE9BQU87SUFDaEIsVUFBVSxFQUFFLFNBQVM7Q0FDdEIsQ0FBQyxDQUFDO0FBRUgscUJBQXFCO0FBQ3JCLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIiMhL3Vzci9iaW4vZW52IG5vZGVcbmltcG9ydCAnc291cmNlLW1hcC1zdXBwb3J0L3JlZ2lzdGVyJztcbmltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgeyBnZXRFbnZpcm9ubWVudENvbmZpZyB9IGZyb20gJy4uL2xpYi91dGlscy9lbnZpcm9ubWVudCc7XG5pbXBvcnQgeyBOYW1pbmdIZWxwZXIgfSBmcm9tICcuLi9saWIvdXRpbHMvbmFtaW5nJztcbmltcG9ydCB7IGNyZWF0ZVRhZ2dpbmdIZWxwZXIgfSBmcm9tICcuLi9saWIvdXRpbHMvdGFncyc7XG5pbXBvcnQgeyBTVEFDS19OQU1FUyB9IGZyb20gJy4uL2xpYi91dGlscy9jb25zdGFudHMnO1xuXG4vLyBJbXBvcnQgYWxsIHN0YWNrc1xuaW1wb3J0IHsgSWFtU3RhY2sgfSBmcm9tICcuLi9saWIvc3RhY2tzL2lhbS1zdGFjayc7XG5pbXBvcnQgeyBWcGNTdGFjayB9IGZyb20gJy4uL2xpYi9zdGFja3MvdnBjLXN0YWNrJztcbmltcG9ydCB7IFNlY3VyaXR5R3JvdXBTdGFjayB9IGZyb20gJy4uL2xpYi9zdGFja3Mvc2VjdXJpdHktZ3JvdXAtc3RhY2snO1xuaW1wb3J0IHsgUzNTdGFjayB9IGZyb20gJy4uL2xpYi9zdGFja3MvczMtc3RhY2snO1xuaW1wb3J0IHsgRGF0YWJhc2VTdGFjayB9IGZyb20gJy4uL2xpYi9zdGFja3MvZGF0YWJhc2Utc3RhY2snO1xuaW1wb3J0IHsgRWMyU3RhY2sgfSBmcm9tICcuLi9saWIvc3RhY2tzL2VjMi1zdGFjayc7XG5pbXBvcnQgeyBMYW1iZGFTdGFjayB9IGZyb20gJy4uL2xpYi9zdGFja3MvbGFtYmRhLXN0YWNrJztcbmltcG9ydCB7IEFwaUdhdGV3YXlTdGFjayB9IGZyb20gJy4uL2xpYi9zdGFja3MvYXBpLWdhdGV3YXktc3RhY2snO1xuXG5jb25zdCBhcHAgPSBuZXcgY2RrLkFwcCgpO1xuXG4vLyBHZXQgZW52aXJvbm1lbnQgY29uZmlndXJhdGlvblxuY29uc3QgY29uZmlnID0gZ2V0RW52aXJvbm1lbnRDb25maWcoYXBwKTtcbmNvbnN0IG5hbWluZ0hlbHBlciA9IG5ldyBOYW1pbmdIZWxwZXIoY29uZmlnLnN0YWdlKTtcbmNvbnN0IHRhZ2dpbmdIZWxwZXIgPSBjcmVhdGVUYWdnaW5nSGVscGVyKGNvbmZpZy5zdGFnZSk7XG5cbmNvbnNvbGUubG9nKGBEZXBsb3lpbmcgdG8gJHtjb25maWcuc3RhZ2V9IGVudmlyb25tZW50YCk7XG5jb25zb2xlLmxvZyhgUmVnaW9uOiAke2NvbmZpZy5lbnZpcm9ubWVudC5yZWdpb259YCk7XG5jb25zb2xlLmxvZyhgQWNjb3VudDogJHtjb25maWcuZW52aXJvbm1lbnQuYWNjb3VudH1gKTtcblxuLy8gU3RhY2sgcHJvcGVydGllc1xuY29uc3Qgc3RhY2tQcm9wczogY2RrLlN0YWNrUHJvcHMgPSB7XG4gIGVudjogY29uZmlnLmVudmlyb25tZW50LFxuICBkZXNjcmlwdGlvbjogYCR7Y29uZmlnLnN0YWdlfSBlbnZpcm9ubWVudCBzdGFjayBmb3Igc2VydmVybGVzcyBiYWNrZW5kIGluZnJhc3RydWN0dXJlYCxcbiAgdGVybWluYXRpb25Qcm90ZWN0aW9uOiBjb25maWcuaXNQcm9kXG59O1xuXG4vLyBDcmVhdGUgSUFNIFN0YWNrIChtdXN0IGJlIGZpcnN0KVxuY29uc3QgaWFtU3RhY2sgPSBuZXcgSWFtU3RhY2soYXBwLCBuYW1pbmdIZWxwZXIuZ2V0U3RhY2tOYW1lKFNUQUNLX05BTUVTLklBTSksIHtcbiAgLi4uc3RhY2tQcm9wcyxcbiAgY29uZmlnLFxuICBuYW1pbmdIZWxwZXIsXG4gIHRhZ2dpbmdIZWxwZXJcbn0pO1xuXG4vLyBDcmVhdGUgVlBDIFN0YWNrXG5jb25zdCB2cGNTdGFjayA9IG5ldyBWcGNTdGFjayhhcHAsIG5hbWluZ0hlbHBlci5nZXRTdGFja05hbWUoU1RBQ0tfTkFNRVMuVlBDKSwge1xuICAuLi5zdGFja1Byb3BzLFxuICBjb25maWcsXG4gIG5hbWluZ0hlbHBlcixcbiAgdGFnZ2luZ0hlbHBlclxufSk7XG5cbi8vIENyZWF0ZSBTZWN1cml0eSBHcm91cCBTdGFja1xuY29uc3Qgc2VjdXJpdHlHcm91cFN0YWNrID0gbmV3IFNlY3VyaXR5R3JvdXBTdGFjayhhcHAsIG5hbWluZ0hlbHBlci5nZXRTdGFja05hbWUoU1RBQ0tfTkFNRVMuU0VDVVJJVFlfR1JPVVApLCB7XG4gIC4uLnN0YWNrUHJvcHMsXG4gIGNvbmZpZyxcbiAgbmFtaW5nSGVscGVyLFxuICB0YWdnaW5nSGVscGVyLFxuICB2cGM6IHZwY1N0YWNrLnZwY1xufSk7XG5cbi8vIENyZWF0ZSBTMyBTdGFja1xuY29uc3QgczNTdGFjayA9IG5ldyBTM1N0YWNrKGFwcCwgbmFtaW5nSGVscGVyLmdldFN0YWNrTmFtZShTVEFDS19OQU1FUy5TMyksIHtcbiAgLi4uc3RhY2tQcm9wcyxcbiAgY29uZmlnLFxuICBuYW1pbmdIZWxwZXIsXG4gIHRhZ2dpbmdIZWxwZXJcbn0pO1xuXG4vLyBDcmVhdGUgRGF0YWJhc2UgU3RhY2tcbmNvbnN0IGRhdGFiYXNlU3RhY2sgPSBuZXcgRGF0YWJhc2VTdGFjayhhcHAsIG5hbWluZ0hlbHBlci5nZXRTdGFja05hbWUoU1RBQ0tfTkFNRVMuREFUQUJBU0UpLCB7XG4gIC4uLnN0YWNrUHJvcHMsXG4gIGNvbmZpZyxcbiAgbmFtaW5nSGVscGVyLFxuICB0YWdnaW5nSGVscGVyLFxuICB2cGM6IHZwY1N0YWNrLnZwYyxcbiAgZGF0YWJhc2VTZWN1cml0eUdyb3VwczogW1xuICAgIHNlY3VyaXR5R3JvdXBTdGFjay5kYlNzaEdyb3VwLFxuICAgIHNlY3VyaXR5R3JvdXBTdGFjay5kYlByaXZhdGVHcm91cFxuICBdXG59KTtcblxuLy8gQ3JlYXRlIEVDMiBTdGFja1xuY29uc3QgZWMyU3RhY2sgPSBuZXcgRWMyU3RhY2soYXBwLCBuYW1pbmdIZWxwZXIuZ2V0U3RhY2tOYW1lKFNUQUNLX05BTUVTLkVDMiksIHtcbiAgLi4uc3RhY2tQcm9wcyxcbiAgY29uZmlnLFxuICBuYW1pbmdIZWxwZXIsXG4gIHRhZ2dpbmdIZWxwZXIsXG4gIHZwYzogdnBjU3RhY2sudnBjLFxuICBwdWJsaWNTc2hTZWN1cml0eUdyb3VwOiBzZWN1cml0eUdyb3VwU3RhY2sucHVibGljU3NoR3JvdXAsXG4gIGJhc3Rpb25PdXRib3VuZFNlY3VyaXR5R3JvdXA6IHNlY3VyaXR5R3JvdXBTdGFjay5iYXN0aW9uT3V0Ym91bmRHcm91cCxcbiAgbmF0U2VjdXJpdHlHcm91cDogc2VjdXJpdHlHcm91cFN0YWNrLm5hdEdyb3VwXG59KTtcblxuLy8gQ3JlYXRlIExhbWJkYSBTdGFja1xuY29uc3QgbGFtYmRhU3RhY2sgPSBuZXcgTGFtYmRhU3RhY2soYXBwLCBuYW1pbmdIZWxwZXIuZ2V0U3RhY2tOYW1lKFNUQUNLX05BTUVTLkxBTUJEQSksIHtcbiAgLi4uc3RhY2tQcm9wcyxcbiAgY29uZmlnLFxuICBuYW1pbmdIZWxwZXIsXG4gIHRhZ2dpbmdIZWxwZXIsXG4gIHZwYzogdnBjU3RhY2sudnBjLFxuICBsYW1iZGFTZWN1cml0eUdyb3VwOiBzZWN1cml0eUdyb3VwU3RhY2subGFtYmRhT3V0Ym91bmRHcm91cCxcbiAgbGFtYmRhUm9sZTogaWFtU3RhY2suY3VzdG9tTGFtYmRhQ29tbW9uUm9sZVxufSk7XG5cbi8vIENyZWF0ZSBBUEkgR2F0ZXdheSBTdGFja1xuY29uc3QgYXBpR2F0ZXdheVN0YWNrID0gbmV3IEFwaUdhdGV3YXlTdGFjayhhcHAsIG5hbWluZ0hlbHBlci5nZXRTdGFja05hbWUoU1RBQ0tfTkFNRVMuQVBJX0dBVEVXQVkpLCB7XG4gIC4uLnN0YWNrUHJvcHMsXG4gIGNvbmZpZyxcbiAgbmFtaW5nSGVscGVyLFxuICB0YWdnaW5nSGVscGVyLFxuICBoZWFsdGhDaGVja0Z1bmN0aW9uOiBsYW1iZGFTdGFjay5oZWFsdGhDaGVja0Z1bmN0aW9uLFxuICBhcGlHYXRld2F5Um9sZTogaWFtU3RhY2suY3VzdG9tQXBpR2F0ZXdheUxvZ1JvbGVcbn0pO1xuXG4vLyBTZXQgdXAgZGVwZW5kZW5jaWVzXG5zZWN1cml0eUdyb3VwU3RhY2suYWRkRGVwZW5kZW5jeSh2cGNTdGFjayk7XG5kYXRhYmFzZVN0YWNrLmFkZERlcGVuZGVuY3koc2VjdXJpdHlHcm91cFN0YWNrKTtcbmVjMlN0YWNrLmFkZERlcGVuZGVuY3koc2VjdXJpdHlHcm91cFN0YWNrKTtcbmxhbWJkYVN0YWNrLmFkZERlcGVuZGVuY3koc2VjdXJpdHlHcm91cFN0YWNrKTtcbmxhbWJkYVN0YWNrLmFkZERlcGVuZGVuY3koaWFtU3RhY2spO1xuYXBpR2F0ZXdheVN0YWNrLmFkZERlcGVuZGVuY3kobGFtYmRhU3RhY2spO1xuYXBpR2F0ZXdheVN0YWNrLmFkZERlcGVuZGVuY3koaWFtU3RhY2spO1xuXG4vLyBBcHBseSB0YWdzIHRvIHRoZSBlbnRpcmUgYXBwXG50YWdnaW5nSGVscGVyLmFwcGx5VGFncyhhcHAsIHtcbiAgQXBwbGljYXRpb246ICdTZXJ2ZXJsZXNzIEJhY2tlbmQnLFxuICBWZXJzaW9uOiAnMS4wLjAnLFxuICBSZXBvc2l0b3J5OiAnY2RrLXByaidcbn0pO1xuXG4vLyBTeW50aGVzaXplIHRoZSBhcHBcbmFwcC5zeW50aCgpOyJdfQ==